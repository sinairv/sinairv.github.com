
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sina Iravanian</title>
  <meta name="author" content="Sina Iravanian">

  
  <meta name="description" content="The source code for this post is on GitHub. When it comes to mocking a DbSet to test various read and write operations things may get a little bit &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sinairv.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Sina Iravanian" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46467071-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Sina Iravanian</a></h1>
  
    <h2>I blog about software development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sinairv.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
  <li><a href="/works">Works</a></li>
  <li><a href="/notebook">Notebook</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/10/04/mock-entity-framework-dbset-with-nsubstitute/">Mock Entity Framework DbSet With NSubstitute</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-10-04T23:33:40+11:00" pubdate data-updated="true">Oct 4<span>th</span>, 2015</time>
        
           | <a href="/blog/2015/10/04/mock-entity-framework-dbset-with-nsubstitute/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2015/10/04/mock-entity-framework-dbset-with-nsubstitute/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The source code for this post is on <a href="https://github.com/sinairv/MockEfDbSetWithNSubstitute">GitHub</a>.</p>

<p>When it comes to mocking a <code>DbSet</code> to test various read and write operations things may get a little bit tricky. Mocking a <code>DbSet</code> for a write operation (<code>Add</code>, <code>Update</code>, or <code>Remove</code>) is quite straightforward. But testing a synchronous read operation requires mocking the whole <code>IQueryable</code> interface. Even more trickier than that is testing an asynchronous read operation which requires mocking an <code>IDbAsyncQueryProvider</code> interface. <a href="https://msdn.microsoft.com/en-au/data/dn314429.aspx">Here</a> is a very good article that demonstrates how to work around these difficulties using <a href="https://github.com/Moq/moq4">Moq</a>. This blog post shows how to achieve the same thing using <a href="http://nsubstitute.github.io/">NSubstitute</a>.</p>

<p>Mocking a <code>DbSet</code> for a write operation is quite straightforward:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">mockSet</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;&gt;();</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockContext</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IPeopleDbContext</span><span class="p">&gt;();</span>
</span><span class="line"><span class="n">mockContext</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">mockSet</span><span class="p">);</span>
</span><span class="line"><span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeopleService</span><span class="p">(</span><span class="n">mockContext</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Act</span>
</span><span class="line"><span class="n">service</span><span class="p">.</span><span class="n">AddPersonAsync</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;John&quot;</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">&quot;Doe&quot;</span> <span class="p">});</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Assert</span>
</span><span class="line"><span class="n">mockSet</span><span class="p">.</span><span class="n">Received</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">Add</span><span class="p">(</span><span class="n">Arg</span><span class="p">.</span><span class="n">Any</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;());</span>
</span><span class="line"><span class="n">mockContext</span><span class="p">.</span><span class="n">Received</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">SaveChangesAsync</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>As seen above mocking the <code>DbSet</code> is as easy as one single call to <code>Substitute.For&lt;DbSet&lt;T&gt;&gt;()</code>.</p>

<p>However mocking a <code>DbSet</code> for a synchronous read operation needs a little bit more work. It needs to mock the whole <code>IQueryable</code> interface:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;BBB&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;ZZZ&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;AAA&quot;</span> <span class="p">},</span>
</span><span class="line"><span class="p">}.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// create a mock DbSet exposing both DbSet and IQueryable interfaces for setup</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockSet</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;,</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;&gt;();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// setup all IQueryable methods using what you have from &quot;data&quot;</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">Provider</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Provider</span><span class="p">);</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">Expression</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Expression</span><span class="p">);</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">ElementType</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ElementType</span><span class="p">);</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">GetEnumerator</span><span class="p">().</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">());</span>
</span><span class="line">
</span><span class="line"><span class="c1">// do the wiring between DbContext and DbSet</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockContext</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IPeopleDbContext</span><span class="p">&gt;();</span>
</span><span class="line"><span class="n">mockContext</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">mockSet</span><span class="p">);</span>
</span><span class="line"><span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeopleService</span><span class="p">(</span><span class="n">mockContext</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Act</span>
</span><span class="line"><span class="kt">var</span> <span class="n">people</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAllPeople</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Assert</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">));</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">people</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">&quot;BBB&quot;</span><span class="p">));</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">people</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">&quot;ZZZ&quot;</span><span class="p">));</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">people</span><span class="p">[</span><span class="m">2</span><span class="p">].</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">&quot;AAA&quot;</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Mocking a <code>DbSet</code> for an asynchronous read operation requires much more work and a bunch of extra classes. <a href="https://msdn.microsoft.com/en-au/data/dn314429.aspx">This article</a> lists the required extra classes. To name add <a href="https://github.com/sinairv/MockEfDbSetWithNSubstitute/blob/master/MockEfDbSet.Test/TestUtils/TestDbAsyncEnumerable.cs"><code>TestDbAsyncEnumerable</code></a>, <a href="https://github.com/sinairv/MockEfDbSetWithNSubstitute/blob/master/MockEfDbSet.Test/TestUtils/TestDbAsyncEnumerator.cs"><code>TestDbAsyncEnumerator</code></a>, and <a href="https://github.com/sinairv/MockEfDbSetWithNSubstitute/blob/master/MockEfDbSet.Test/TestUtils/TestDbAsyncQueryProvider.cs"><code>TestDbAsyncQueryProvider</code></a> classes to your test project. This is how you’d be able to mock <code>DbSet</code> for asynchronous read operations:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;BBB&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;ZZZ&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;AAA&quot;</span> <span class="p">},</span>
</span><span class="line"><span class="p">}.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// create a mock DbSet exposing both DbSet, IQueryable, and IDbAsyncEnumerable interfaces for setup</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockSet</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;,</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;,</span> <span class="n">IDbAsyncEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;&gt;();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// setup all IQueryable and IDbAsyncEnumerable methods using what you have from &quot;data&quot;</span>
</span><span class="line"><span class="c1">// the setup below is a bit different from the test above</span>
</span><span class="line"><span class="p">((</span><span class="n">IDbAsyncEnumerable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">GetAsyncEnumerator</span><span class="p">()</span>
</span><span class="line">    <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="k">new</span> <span class="n">TestDbAsyncEnumerator</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">data</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()));</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">Provider</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="k">new</span> <span class="n">TestDbAsyncQueryProvider</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">data</span><span class="p">.</span><span class="n">Provider</span><span class="p">));</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">Expression</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Expression</span><span class="p">);</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">ElementType</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ElementType</span><span class="p">);</span>
</span><span class="line"><span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;)</span><span class="n">mockSet</span><span class="p">).</span><span class="n">GetEnumerator</span><span class="p">().</span><span class="n">Returns</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">());</span>
</span><span class="line">
</span><span class="line"><span class="c1">// do the wiring between DbContext and DbSet</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockContext</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IPeopleDbContext</span><span class="p">&gt;();</span>
</span><span class="line"><span class="n">mockContext</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">mockSet</span><span class="p">);</span>
</span><span class="line"><span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeopleService</span><span class="p">(</span><span class="n">mockContext</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Act</span>
</span><span class="line"><span class="kt">var</span> <span class="n">people</span> <span class="p">=</span> <span class="k">await</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAllPeopleAsync</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Assert</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">people</span><span class="p">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The amount of code per unit test seems a little bit too much. So I created a utility method that creates the mock <code>DbSet</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">NSubstituteUtils</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">public</span> <span class="k">static</span> <span class="n">DbSet</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">CreateMockDbSet</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">data</span> <span class="p">=</span> <span class="k">null</span><span class="p">)</span>
</span><span class="line">        <span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="k">class</span>
</span><span class="line">    <span class="err">{</span>
</span><span class="line">        <span class="kt">var</span> <span class="n">mockSet</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">DbSet</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;,</span> <span class="n">IDbAsyncEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;();</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="kt">var</span> <span class="n">queryable</span> <span class="p">=</span> <span class="n">data</span><span class="p">.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span class="line">
</span><span class="line">            <span class="c1">// setup all IQueryable and IDbAsyncEnumerable methods using what you have from &quot;data&quot;</span>
</span><span class="line">            <span class="c1">// the setup below is a bit different from the test above</span>
</span><span class="line">            <span class="p">((</span><span class="n">IDbAsyncEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="n">mockSet</span><span class="p">).</span><span class="n">GetAsyncEnumerator</span><span class="p">()</span>
</span><span class="line">                <span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="k">new</span> <span class="n">TestDbAsyncEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">queryable</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()));</span>
</span><span class="line">            <span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="n">mockSet</span><span class="p">).</span><span class="n">Provider</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="k">new</span> <span class="n">TestDbAsyncQueryProvider</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">queryable</span><span class="p">.</span><span class="n">Provider</span><span class="p">));</span>
</span><span class="line">            <span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="n">mockSet</span><span class="p">).</span><span class="n">Expression</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">queryable</span><span class="p">.</span><span class="n">Expression</span><span class="p">);</span>
</span><span class="line">            <span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="n">mockSet</span><span class="p">).</span><span class="n">ElementType</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">queryable</span><span class="p">.</span><span class="n">ElementType</span><span class="p">);</span>
</span><span class="line">            <span class="p">((</span><span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;)</span> <span class="n">mockSet</span><span class="p">).</span><span class="n">GetEnumerator</span><span class="p">().</span><span class="n">Returns</span><span class="p">(</span><span class="n">queryable</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">());</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">return</span> <span class="n">mockSet</span><span class="p">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Exploiting this, the unit test code would become shorter and more readable:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;BBB&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;ZZZ&quot;</span> <span class="p">},</span>
</span><span class="line">    <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;AAA&quot;</span> <span class="p">},</span>
</span><span class="line"><span class="p">};</span>
</span><span class="line">
</span><span class="line"><span class="kt">var</span> <span class="n">mockSet</span> <span class="p">=</span> <span class="n">NSubstituteUtils</span><span class="p">.</span><span class="n">CreateMockDbSet</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span class="line"><span class="kt">var</span> <span class="n">mockContext</span> <span class="p">=</span> <span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IPeopleDbContext</span><span class="p">&gt;();</span>
</span><span class="line"><span class="n">mockContext</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">Returns</span><span class="p">(</span><span class="n">mockSet</span><span class="p">);</span>
</span><span class="line"><span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeopleService</span><span class="p">(</span><span class="n">mockContext</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Act</span>
</span><span class="line"><span class="kt">var</span> <span class="n">secondPerson</span> <span class="p">=</span> <span class="k">await</span> <span class="n">service</span><span class="p">.</span><span class="n">GetPersonAsync</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// Assert</span>
</span><span class="line"><span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">secondPerson</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The source code for this post is accessible from <a href="https://github.com/sinairv/MockEfDbSetWithNSubstitute">here</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/05/18/powershell-the-switch-data-type/">PowerShell: The Switch Data-type</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-18T00:45:18+10:00" pubdate data-updated="true">May 18<span>th</span>, 2015</time>
        
           | <a href="/blog/2015/05/18/powershell-the-switch-data-type/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2015/05/18/powershell-the-switch-data-type/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <code>switch</code> data type is used to control whether a switch (as in arguments or options passed to a function or command) is provided for the function/command or not. Suppose that there is a function called <code>Switch-Demo</code> that can accept <code>-Force</code> and <code>-Quiet</code> switches. These switches just work as toggles. What we care about them is whether they exist or not. There are no pieces of data accompanying them. The PowerShell <code>switch</code> data-type suits this purpose:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="powershell"><span class="line"><span class="k">function</span> <span class="k">Switch</span><span class="n">-Demo</span> <span class="p">{</span>
</span><span class="line">    <span class="k">param</span><span class="p">(</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Force</span><span class="p">,</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Quiet</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span><span class="p">(</span><span class="nv">$Force</span><span class="p">.</span><span class="n">IsPresent</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Forcefully doing the task&quot;</span>
</span><span class="line">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Force is NOT present&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span><span class="p">(</span><span class="nv">$Quiet</span><span class="p">.</span><span class="n">IsPresent</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Quietly doing the task&quot;</span>
</span><span class="line">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Quiet is NOT present&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c"># invocation:</span>
</span><span class="line"><span class="k">Switch</span><span class="n">-Demo</span> <span class="n">-Quiet</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In the invocation of the above example, the <code>Quiet</code> switch is present while the <code>Force</code> switch is not.</p>

<p>As shown above, the <code>.IsPresent</code> property of the <code>switch</code> variable can be used to check whether the particular switch has been passed to the function/command.</p>

<p><strong>Default values</strong> for the parameters of type <code>switch</code> can be specified by Boolean values. To make a switch present by default the <code>[switch]::Present</code> constant can also be used, which is equivalent to <code>$true</code>. As of now I’m not aware of any <code>[switch]::</code> constants that is equivalent to <code>$false</code>. Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="powershell"><span class="line"><span class="k">function</span> <span class="k">Switch</span><span class="n">-Demo</span> <span class="p">{</span>
</span><span class="line">    <span class="k">param</span><span class="p">(</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Force</span><span class="p">=</span><span class="no">[switch]</span><span class="err">::</span><span class="n">Present</span><span class="p">,</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Quiet</span><span class="p">=</span><span class="nv">$false</span><span class="p">,</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$WhatIf</span><span class="p">=</span><span class="nv">$true</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="c"># ...</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This means that the invoker does not need to specify <code>-Force</code> switch (it is by default considered to be provided). What if the invoker doesn’t like the <code>-Force</code> switch to be present? To override that the invoker can specify Boolean constants as values for the switch:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="powershell"><span class="line"><span class="k">Switch</span><span class="n">-Demo</span> <span class="n">-Force</span><span class="err">:</span><span class="nv">$false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I personally don’t find this way of overriding switch values quite intuitive. I’d rather name <code>switch</code> variables in a way that their default value is <code>$false</code>, or when not possible provide another switch with a negative name compared to the other one that overrides its functionality. Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="powershell"><span class="line"><span class="k">function</span> <span class="k">Switch</span><span class="n">-Demo</span> <span class="p">{</span>
</span><span class="line">    <span class="k">param</span><span class="p">(</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Quiet</span><span class="p">=</span><span class="no">[switch]</span><span class="err">::</span><span class="n">Present</span><span class="p">,</span>
</span><span class="line">        <span class="no">[switch]</span><span class="nv">$Verbose</span>
</span><span class="line">    <span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="c"># Override the values</span>
</span><span class="line">    <span class="k">if</span><span class="p">(</span><span class="nv">$Verbose</span><span class="p">.</span><span class="n">IsPresent</span><span class="p">){</span>
</span><span class="line">        <span class="nv">$Quiet</span> <span class="p">=</span> <span class="nv">$false</span><span class="err">;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="c"># Check the values</span>
</span><span class="line">    <span class="k">if</span><span class="p">(</span><span class="nv">$Quiet</span><span class="p">.</span><span class="n">IsPresent</span><span class="p">){</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Quietly doing the job.&quot;</span>
</span><span class="line">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class="line">        <span class="nb">Write-Host</span> <span class="s2">&quot;Verbosely doing the job.&quot;</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c"># invocations:</span>
</span><span class="line"><span class="k">Switch</span><span class="n">-Demo</span> <span class="n">-Quiet</span>
</span><span class="line"><span class="k">Switch</span><span class="n">-Demo</span> <span class="n">-Verbose</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/15/handy-extensions-for-inotifypropertychanged/">Handy Extensions for INotifyPropertyChanged</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-15T01:22:39+11:00" pubdate data-updated="true">Jan 15<span>th</span>, 2015</time>
        
           | <a href="/blog/2015/01/15/handy-extensions-for-inotifypropertychanged/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2015/01/15/handy-extensions-for-inotifypropertychanged/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently created a <a href="https://github.com/sinairv/INPC-Extensions">library</a> that contains some handy extensions for <code>INotifyPropertyChanged</code> interface (aka INPC). To start using the library, add the following to the top of your C# code:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">using</span> <span class="nn">NotifyPropertyChangedExtensions</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="how-to-easily-raise-inpc-in-a-refactor-friendly-way">How to easily raise INPC in a refactor friendly way</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">MyClass</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">private</span> <span class="kt">int</span> <span class="n">_number</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="kt">int</span> <span class="n">Number</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_number</span><span class="p">;</span> <span class="p">}</span>
</span><span class="line">        <span class="k">set</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">if</span><span class="p">(</span><span class="n">_number</span> <span class="p">!=</span> <span class="k">value</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="n">_number</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class="line">                <span class="k">this</span><span class="p">.</span><span class="n">RaisePropertyChanged</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">Number</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="how-to-easily-handle-listen-to-inpc-in-a-refactor-friendly-way">How to easily handle (listen to) INPC in a refactor friendly way</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="n">MyClass</span> <span class="n">myObject</span> <span class="p">=</span> <span class="p">...;</span>
</span><span class="line">
</span><span class="line"><span class="n">myObject</span><span class="p">.</span><span class="n">HandleOnPropertyChanged</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">Number</span><span class="p">,</span> <span class="n">sender</span> <span class="p">=&gt;</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Number changed to {0}&quot;</span><span class="p">,</span> <span class="n">sender</span><span class="p">.</span><span class="n">Number</span><span class="p">);</span>
</span><span class="line">    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="how-to-do-one-way-binding-from-a-class-that-implements-inpc">How to do one-way binding from a class that implements INPC</h4>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyClass</span><span class="p">();</span>
</span><span class="line"><span class="kt">var</span> <span class="n">target</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TargetClass</span><span class="p">();</span>
</span><span class="line">
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">BindProperty</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">Number</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">Num</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">Number</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class="line"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">Num</span><span class="p">);</span> <span class="c1">// 10</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You can negate a boolean property while binding it. I use it a lot and find it very handy.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">BindProperty</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">IsActive</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">t</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">t</span><span class="p">.</span><span class="n">IsDeleted</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">IsActive</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class="line"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">IsDeleted</span><span class="p">);</span> <span class="c1">// True</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You can bind primitive data-types in source class to <code>Nullable</code> primitive data-types in the target class, and vice versa. </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">BindProperty</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">Number</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">NullableNumber</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>What happens if source is <code>null</code>, and the target is not <code>Nullable</code>? </p>

<p>The default behavior is to update target with default value of that type:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="n">target</span><span class="p">.</span><span class="n">Number</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">BindProperty</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">NullableNumber</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">Number</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">NullableNumber</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class="line"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">Number</span><span class="p">);</span> <span class="c1">// 0</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You can also choose not to update target if source becomes <code>null</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="n">target</span><span class="p">.</span><span class="n">Number</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">BindProperty</span><span class="p">(</span><span class="n">src</span> <span class="p">=&gt;</span> <span class="n">src</span><span class="p">.</span><span class="n">NullableNumber</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">t</span> <span class="p">=&gt;</span> <span class="n">t</span><span class="p">.</span><span class="n">Number</span><span class="p">,</span>
</span><span class="line">    <span class="n">BindPropertyOptions</span><span class="p">.</span><span class="n">DontUpdateWhenSourceIsNullAndTargetIsNotNullable</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">source</span><span class="p">.</span><span class="n">NullableNumber</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class="line"><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">Number</span><span class="p">);</span> <span class="c1">// still 10</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="how-to-find-more-information-about-this-library">How to find more information about this library?</h4>

<p>At the moment the best way to find out how this library works is by reading the unit tests or at least their titles.</p>

<p><a href="https://github.com/sinairv/INPC-Extensions">INPC-Extensions</a> is now hosted in GitHub and is licensed under MIT.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/01/syntax-highlighter-for-windows-forms-rich-text-box/">Syntax Highlighter for Windows Forms Rich Text Box</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-12-01T19:18:48+11:00" pubdate data-updated="true">Dec 1<span>st</span>, 2014</time>
        
           | <a href="/blog/2014/12/01/syntax-highlighter-for-windows-forms-rich-text-box/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2014/12/01/syntax-highlighter-for-windows-forms-rich-text-box/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Years ago I created a tool called <a href="http://code4public.codeplex.com">Code4Public</a> to convert source code into HTML called. I was using this tool to put nice code snippets in the blog I used to maintain at that time. The tool is able to get the code, apply syntax highlighting to it based on the syntax of the language selected, and then create HTML based on the theme selected (e.g., MSDN theme). I didn’t assign more time on making the tool better and better, as better ways of doing the same task were emerging, and also other by-products of the tool were becoming more interesting at the time; e.g., <a href="https://github.com/sinairv/YAXLib">YAXLib</a> was a little by-product of Code4Public used to store settings, themes and language syntaxes in XML files.</p>

<p>This post is to introduce yet another by-product of Code4Public: <a href="https://github.com/sinairv/WinFormsSyntaxHighlighter">WinFormsSyntaxHighlighter</a>. This library enables syntax highlighting on a <code>RichTextBox</code> based on patterns that the developer defines.</p>

<p>The syntax highlighter hooks into <code>RichTextBox</code> events in the constructor.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">syntaxHighlighter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SyntaxHighlighter</span><span class="p">(</span><span class="n">theRichTextBox</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>That’s it. Now I need to define patterns and colors. For example I want to see <code>for</code>, <code>foreach</code>, <code>int</code> and <code>var</code> in blue:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="c1">// 1st set of keywords; I&#39;d like to see them in Blue</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">&quot;for&quot;</span><span class="p">,</span> <span class="s">&quot;foreach&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="s">&quot;var&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I can also define whether I want to see a pattern in <em>bold</em> or <em>italics</em>. For example I want to see <code>public</code>, <code>partial</code>, <code>class</code>, and <code>void</code> in bold navy but not italics. I want the match these words case-insensitively, so that <code>PuBlIc</code> will be shown in navy blue as well. Note that this is an imaginary syntax for demonstration purposes only:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="c1">// 2nd set of keywords; I&#39;d like to see them in bold Navy, and they must be case insensitive</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">CaseInsensitivePatternDefinition</span><span class="p">(</span><span class="s">&quot;public&quot;</span><span class="p">,</span> <span class="s">&quot;partial&quot;</span><span class="p">,</span> <span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;void&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Navy</span><span class="p">,</span> <span class="n">bold</span><span class="p">:</span> <span class="k">true</span><span class="p">,</span> <span class="n">italic</span><span class="p">:</span> <span class="k">false</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I can also define the patterns directly with regular expression:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="c1">// numbers; I&#39;d like to see them in purple</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">@&quot;\d+\.\d+|\d+&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Purple</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Since the input string is partitioned by the patterns defined in the order of their definition, they must be added in the proper order. E.g., I want to see numbers in purple, but not those numbers inside a comment or inside a string. So the pattern definition for a comment block must be added first, then the pattern for string literal, and at last the pattern for numbers. The following is a more complete example from the beginning to the end.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">syntaxHighlighter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SyntaxHighlighter</span><span class="p">(</span><span class="n">theRichTextBox</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c1">// That&#39;s it. Now tell me how you&#39;d like to see what...</span>
</span><span class="line">
</span><span class="line"><span class="c1">// multi-line comments; I&#39;d like to see them in dark-sea-green and italic</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">@&quot;/\*(.|[\r\n])*?\*/&quot;</span><span class="p">,</span> 
</span><span class="line">        <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Multiline</span> <span class="p">|</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">)),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">DarkSeaGreen</span><span class="p">,</span> <span class="n">bold</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="n">italic</span><span class="p">:</span> <span class="k">true</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// singlie-line comments; I&#39;d like to see them in Green and italic</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="k">new</span> <span class="n">Regex</span><span class="p">(</span><span class="s">@&quot;//.*?$&quot;</span><span class="p">,</span> 
</span><span class="line">        <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Multiline</span> <span class="p">|</span> <span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">)),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="n">bold</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="n">italic</span><span class="p">:</span> <span class="k">true</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// double quote strings; I&#39;d like to see them in Red</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">@&quot;\&quot;&quot;([^&quot;&quot;]|\&quot;&quot;\&quot;&quot;)+\&quot;&quot;&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// single quote strings; I&#39;d like to see them in Salmon </span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">@&quot;\&#39;([^&#39;]|\&#39;\&#39;)+\&#39;&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Salmon</span><span class="p">));</span>
</span><span class="line">            
</span><span class="line"><span class="c1">// 1st set of keywords; I&#39;d like to see them in Blue</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">&quot;for&quot;</span><span class="p">,</span> <span class="s">&quot;foreach&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="s">&quot;var&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Blue</span><span class="p">));</span>
</span><span class="line">            
</span><span class="line"><span class="c1">// 2nd set of keywords; I&#39;d like to see them in bold Navy, and they must be case insensitive</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">CaseInsensitivePatternDefinition</span><span class="p">(</span><span class="s">&quot;public&quot;</span><span class="p">,</span> <span class="s">&quot;partial&quot;</span><span class="p">,</span> <span class="s">&quot;class&quot;</span><span class="p">,</span> <span class="s">&quot;void&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Navy</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">false</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// numbers; I&#39;d like to see them in purple</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">@&quot;\d+\.\d+|\d+&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Purple</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="c1">// operators; I&#39;d like to see them in Brown</span>
</span><span class="line"><span class="n">syntaxHighlighter</span><span class="p">.</span><span class="n">AddPattern</span><span class="p">(</span>
</span><span class="line">    <span class="k">new</span> <span class="nf">PatternDefinition</span><span class="p">(</span><span class="s">&quot;+&quot;</span><span class="p">,</span> <span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s">&quot;|&quot;</span><span class="p">),</span> 
</span><span class="line">    <span class="k">new</span> <span class="nf">SyntaxStyle</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="n">Brown</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Please also note that, nobody can model a whole language like C# or Java with regular expressions, because these languages are not regular. So this tool is by no means a complete and error-free way of modeling languages. Use this just for simple key-word matching or pattern matching and coloring them as you like; but don’t expect too much.</p>

<p><a href="https://github.com/sinairv/WinFormsSyntaxHighlighter">WinFormsSyntaxHighlighter</a> is hosted in GitHub and is licensed under MIT.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/20/the-pains-of-upgrading-android-studio/">The Pains of Upgrading Android Studio</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-20T20:32:23+10:00" pubdate data-updated="true">Apr 20<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/04/20/the-pains-of-upgrading-android-studio/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2014/04/20/the-pains-of-upgrading-android-studio/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I could gracefully install and test earlier versions of Android Studio before they adopted <a href="http://www.gradle.org/">Gradle</a> for their build system. After doing the upgrade I could no longer build a single project with weird error messages relating to Gradle. I searched the web, and found some workarounds in stackoverflow, e.g., manually installing Gradle, updating environment variables and so and so. None of them were helpful for me, although they seemed to be solving the issue for many (who have voted for the answers). I had to do the following steps instead:</p>

<ol>
  <li>Downloaded the latest version of SDK which is bundled with Eclipse. Although many answers suggested to upgrade the SDK to the latest version through SDK Manager, and I did so; it did not solve my problem. So I downloaded a fresh copy of latest SDK bundled with eclipse, and then updated Android Studio settings to refer to this new SDK. This trick solved the build problem.</li>
  <li>When running the emulator I got a very descriptive error message (#NOT) that says: <em>PANIC: could not open Nexus</em>, in which <em>Nexus</em> is the name of my emulator. For this problem what I found on stackoverflow was quite helpful, for example see <a href="http://stackoverflow.com/questions/15103782/avd-panic-could-not-open-not-a-path-issue">this thread</a>. The trick is to create an environment variable called <code>ANDROID_SDK_HOME</code> and set it to the path of the folder containing <code>.android</code> folder. If you don’t know where is your <code>.android</code> folder, AVD Manager will give you the path in its main screen right above the list of existing virtual devices. For my case it was in <code>D:\Documents</code>. After setting the environment variable I had to restart both AVD Manager and Android Studio.</li>
</ol>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/10/moved-my-blog-to-octopress/">Moved My Blog to Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-10T02:22:25+11:00" pubdate data-updated="true">Jan 10<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/01/10/moved-my-blog-to-octopress/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2014/01/10/moved-my-blog-to-octopress/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve moved my blog from <a href="http://sinairv.wordpress.com">Wordpress</a> to my <a href="http://sinairv.github.io">homepage domain</a>. It makes use of <a href="http://octopress.org/">Octopress</a>, which is based on <a href="http://jekyllrb.com/">Jekyll</a>, and is a static site generator. The blog is hosted on GitHub pages, and is <a href="https://github.com/sinairv/sinairv.github.com">open source</a>. </p>

<p>The great benefit of this stack of tools is that I can easily create and edit my posts in <a href="http://en.wikipedia.org/wiki/Markdown">Markdown</a>, re-generate the blog <a href="http://octopress.org/docs/blogging/">through command line</a>, and make use of <a href="http://rake.rubyforge.org/">Rake</a> (Ruby’s make tools) to perform various tasks ranging from post creation to deployment to GitHub pages. It’s awesome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/01/how-to-make-more-refactoring-friendly-data-bindings-with-c-number-5/">How to Make More Refactoring Friendly Data-bindings With C# 5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-01T20:46:29+11:00" pubdate data-updated="true">Nov 1<span>st</span>, 2012</time>
        
           | <a href="/blog/2012/11/01/how-to-make-more-refactoring-friendly-data-bindings-with-c-number-5/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2012/11/01/how-to-make-more-refactoring-friendly-data-bindings-with-c-number-5/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Imagine that we want to create a <code>Person</code> business object for whose properties we desire a two-way data binding. The source-to-target data-binding can be triggered by implementing <code>INotifyPropertyChanged</code> interface, like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">private</span> <span class="kt">string</span> <span class="n">_name</span><span class="p">;</span>
</span><span class="line">    <span class="k">private</span> <span class="kt">double</span> <span class="n">_age</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> 
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">get</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_name</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">set</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">!=</span> <span class="n">_name</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="n">_name</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class="line">                <span class="n">OnPropertyChanged</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="kt">double</span> <span class="n">Age</span> 
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">get</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_age</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">set</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="n">_age</span> <span class="p">!=</span> <span class="k">value</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="n">_age</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class="line">                <span class="n">OnPropertyChanged</span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">);</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="kt">string</span> <span class="n">propertyName</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">PropertyChanged</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="n">PropertyChanged</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>See how the setters pass the property name in a <code>string</code>. This is not nice, because whenever we change the property name through refactoring tools, the string value remains untouched and we have to manually change them as well (if we are lucky enough to get notified before run-time). Anyway we had to tolerate them for years…</p>

<p>C# 5 comes with a nice feature, which is addition of two attributes <code>[CallerFilePath]</code> and <code>[CallerMemberName]</code> in the <code>System.Runtime.CompilerServices</code> namespace. If you decorate an <strong>optional</strong> string parameter of a method with one of these attributes, then the value of that parameter will be replaced with the caller’s file name or the caller’s member name at runtime, if no explicit value is passed for the optional parameter. They come very handy in logging scenarios, but we can use the latter for making our data-binding code nicer. This is how:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="k">private</span> <span class="kt">string</span> <span class="n">_name</span><span class="p">;</span>
</span><span class="line">    <span class="k">private</span> <span class="kt">double</span> <span class="n">_age</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> 
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">get</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_name</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">set</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="k">value</span> <span class="p">!=</span> <span class="n">_name</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="n">_name</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class="line">                <span class="n">OnPropertyChanged</span><span class="p">();</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="kt">double</span> <span class="n">Age</span> 
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">get</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_age</span><span class="p">;</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">
</span><span class="line">        <span class="k">set</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="n">_age</span> <span class="p">!=</span> <span class="k">value</span><span class="p">)</span>
</span><span class="line">            <span class="p">{</span>
</span><span class="line">                <span class="n">_age</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
</span><span class="line">                <span class="n">OnPropertyChanged</span><span class="p">();</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">public</span> <span class="k">event</span> <span class="n">PropertyChangedEventHandler</span> <span class="n">PropertyChanged</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">    <span class="k">private</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">([</span><span class="n">CallerMemberName</span><span class="p">]</span><span class="kt">string</span> <span class="n">propertyName</span> <span class="p">=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span class="line">    <span class="p">{</span>
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">PropertyChanged</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class="line">        <span class="p">{</span>
</span><span class="line">            <span class="n">PropertyChanged</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">PropertyChangedEventArgs</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
</span><span class="line">        <span class="p">}</span>
</span><span class="line">    <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Now that string constants are removed from the setters we can more freely refactor our code. After being spoiled by automatic properties, this is still a very verbose way of defining properties; however it is much better than before.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/22/different-ways-of-generating-new-guids/">Different Ways of Generating New GUIDs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-22T17:49:59+10:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2012</time>
        
           | <a href="/blog/2012/09/22/different-ways-of-generating-new-guids/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2012/09/22/different-ways-of-generating-new-guids/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3 id="in-c-code">In C# Code</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">var</span> <span class="n">newGuid</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="in-visual-studio">In Visual Studio</h3>
<p>Go to: <code>Tools &gt; Create GUID</code></p>

<h3 id="in-sql-server-management-studio">In SQL Server Management Studio</h3>
<p>Execute either of the following queries:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="k">SELECT</span> <span class="n">NEWID</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>or</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="sql"><span class="line"><span class="n">PRINT</span> <span class="n">NEWID</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="none-of-the-above">None of the above</h3>
<p>Go to <a href="http://newguid.com/">newguid.com</a>, and refresh the page as many times as you want.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/23/an-example-for-c-number-dynamic-in-action/">An Example for C# Dynamic in Action</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-23T17:20:53+10:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2012</time>
        
           | <a href="/blog/2012/07/23/an-example-for-c-number-dynamic-in-action/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2012/07/23/an-example-for-c-number-dynamic-in-action/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I was involved with enabling validation for a Windows Forms form containing several pages shown through a tree view. There were one user control defined for each page, therefore whenever a node in tree-view got activated, an instance of that user-control were shown. The user-controls did not have a common user-defined parent base-class or interface. The author of the existing code had defined a <code>Save</code> method in each control separately which performed updating data with values entered in the forms.</p>

<p>First, I changed all <code>void Save()</code> methods to <code>bool Save()</code>, and performed the validation stuff in each control separately. Then in the parent form, I created an array of <code>Control</code>s, so that I could loop through them, and call their <code>Save</code> method. But wait, <code>Save</code> is not inherited from any base-class or interface, so there’s no polymorphism at hand. How can I call them through references of type <code>Control</code>?</p>

<p>Well honestly, the best solution would be adding a new interface to the project, say <code>ISavableControl</code> or something, add the <code>Save</code> method to it, and let the controls implement that interface. But I wanted to make a quick fix to the problem without adding new files and types to the code. Here C#’s <code>dynamic</code> comes into action.</p>

<p>Using <code>dynamic</code> keyword, one postpones binding methods, properties, and fields to run-time. In our scenario we know that the user-controls each have a method called <code>Save</code>, which is not derived from a parent. Without <code>dynamic</code>, I would need to have a reference explicitly from each user control’s type, and I would have to call them one by one, as in:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="kt">bool</span> <span class="n">succeeded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class="line"><span class="n">succeeded</span> <span class="p">=</span> <span class="n">userControl1</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
</span><span class="line"><span class="n">succeeded</span> <span class="p">=</span> <span class="n">succeeded</span> <span class="p">||</span> <span class="n">userControl2</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
</span><span class="line"><span class="n">succeeded</span> <span class="p">=</span> <span class="n">succeeded</span> <span class="p">||</span> <span class="n">userControl3</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
</span><span class="line"><span class="c1">// ...</span>
</span><span class="line"><span class="n">succeeded</span> <span class="p">=</span> <span class="n">succeeded</span> <span class="p">||</span> <span class="n">userControln</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>However using <code>dynamic</code> keyword, life gets a lot easier:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="csharp"><span class="line"><span class="c1">// objects are not inherited from a base class or interface,</span>
</span><span class="line"><span class="c1">// therefore we cannot call Save using polymorphism</span>
</span><span class="line"><span class="kt">bool</span> <span class="n">succeeded</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class="line"><span class="k">foreach</span><span class="p">(</span><span class="kt">var</span> <span class="n">ctrl</span> <span class="k">in</span> <span class="n">controlsArray</span><span class="p">)</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">    <span class="kt">dynamic</span> <span class="n">dynCtrl</span> <span class="p">=</span> <span class="n">ctrl</span><span class="p">;</span>
</span><span class="line">    <span class="n">succeeded</span> <span class="p">=</span> <span class="n">succeeded</span> <span class="p">||</span> <span class="n">dynCtrl</span><span class="p">.</span><span class="n">Save</span><span class="p">();</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">// do something with the value of succeeded</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Take care that binding the <code>Save</code> methods to controls happen at runtime. Therefore if a control does not implement a <code>Save</code> method, or if another one misspells <code>Save</code>, as say <code>Svae</code>, you will get no hints at compile time. So, try to avoid this style of coding, unless you have good reasons for doing so.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/27/programming-koans-one-of-the-best-ways-to-learn-a-new-language-or-framework/">Programming Koans: One of the Best Ways to Learn a New Language or Framework</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-27T16:46:35+10:00" pubdate data-updated="true">May 27<span>th</span>, 2012</time>
        
           | <a href="/blog/2012/05/27/programming-koans-one-of-the-best-ways-to-learn-a-new-language-or-framework/#disqus_thread"
             data-disqus-identifier="http://sinairv.github.io/blog/2012/05/27/programming-koans-one-of-the-best-ways-to-learn-a-new-language-or-framework/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Based on Wikipedia, originally a <a href="http://en.wikipedia.org/wiki/K%C5%8Dan">Koan in Zen-practice</a> is a paradoxical question that provokes doubt and tests a student’s progress. On the other hand, programming Koans are a set of failing unit-tests, for which the learner is required to fix the code or fill the required fields with proper values in order to make each test pass. Probably one of the earliest and most popular Koans were <a href="http://rubykoans.com/">Ruby Koans</a>. Now there are several Koans implemented for different languages and frameworks. Search the word “Koan” in <a href="https://github.com/">GitHub</a> or <a href="https://bitbucket.org/">BitBucket</a> and you will find the gems.</p>

<p>My first experience of Koans was <a href="https://github.com/rally25rs/MoqKoans">MoqKoans</a>, a great set of Koans for learning <a href="http://code.google.com/p/moq/">Moq</a>, a mocking library for the .NET framework. That was really a wonderful learning experience. These days I’m trying to strengthen my web programming skills, and as one of the early steps I decided to remaster JavaScript. I found two JavaScript Koans on GitHub; both of them are great. However, I suggest that one should start with the <a href="https://github.com/liammclennan/JavaScript-Koans">JavaScript Koans by Liam McLennan</a>, which is easier to begin with. after finishing this step, I highly recommend proceeding with the<a href="https://github.com/mrdavidlaing/javascript-koans">JavaScript Koans by David Laing</a>. This one is a smaller set of Koans, but gets more advanced, and contains an introduction to <a href="http://underscorejs.org/">Underscore.js</a> as well.</p>

<p>Experience the joy of learning with Koans, and having all the reds going green in the end.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <a href="http://stackoverflow.com/users/836432/sina-iravanian">
<img src="http://stackoverflow.com/users/flair/836432.png?theme=dark" width="208" height="58" alt="profile for Sina Iravanian at Stack Overflow, Q&A for professional and enthusiast programmers" title="profile for Sina Iravanian at Stack Overflow, Q&A for professional and enthusiast programmers">
</a><a href="https://flattr.com/submit/auto?user_id=sinairv&url=http%3A%2F%2Fsinairv.github.io" target="_blank"><img src="//api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0"></a><a href='https://www.ohloh.net/accounts/143041?ref=Detailed'>
<img alt='Ohloh profile for Sina Iravanian' src='https://www.ohloh.net/accounts/143041/widgets/account_detailed.gif' />
</a>
<a href="https://github.com/sinairv"><img src="/images/github.png" alt="GitHub" title="GitHub" /></a>
<a href="http://www.linkedin.com/in/sinairv"><img src="/images/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
<a href="https://twitter.com/sinairv"><img src="/images/twitter.png" alt="Twitter" title="Twitter" /></a>
<a href="http://nuget.org/profiles/sinairv"><img src="/images/nuget.png" alt="Nuget" title="Nuget" /></a>
<a href="http://www.codeplex.com/site/users/view/sina_iravanian"><img src="/images/codeplex.png" alt="CodePlex" title="CodePlex" /></a>
<a href="http://www.codeproject.com/Articles/Sina-Iravanian"><img src="/images/codeproject.png" alt="CodeProject" title="CodeProject" /></a>
<a href="http://sourceforge.net/users/sina_iravanian"><img src="/images/sourceforge.png" alt="Sourceforge" title="Sourceforge" /></a>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/04/mock-entity-framework-dbset-with-nsubstitute/">Mock Entity Framework DbSet With NSubstitute</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/18/powershell-the-switch-data-type/">PowerShell: The Switch Data-type</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/15/handy-extensions-for-inotifypropertychanged/">Handy Extensions for INotifyPropertyChanged</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/01/syntax-highlighter-for-windows-forms-rich-text-box/">Syntax Highlighter for Windows Forms Rich Text Box</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/20/the-pains-of-upgrading-android-studio/">The Pains of Upgrading Android Studio</a>
      </li>
    
  </ul>
</section>
<a class="twitter-timeline" href="https://twitter.com/sinairv" data-widget-id="412581503571214336">Tweets by @sinairv</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/sinairv">@sinairv</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sinairv',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/+SinaIravanian?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Sina Iravanian -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sinairv';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
